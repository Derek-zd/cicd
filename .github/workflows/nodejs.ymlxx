# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Node.js CI
 
 
 
 
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    #runs-on: self-hosted
    
    runs-on: ubuntu-lastest
    steps:
     - name: Checkout
       uses: actions/checkout@master
     - name: use Node.js 10
       uses: actions/setup-nody@v1
       with:
        node-version: 10
     - name: npm install and build
       run:
         npm -i
         npm run dev
        npm start
       env:
        CI: true
     - name: depoly
        uses: TencentCloud/tke-cluster-credential-action@v1
        env:
         SSH_PRIVATE_KEY: ${{ secreats.SERVER_SSH_KEY}}
         ARGS: ' -rltgoDzvo --delete'
         SOURCE: 'build/'
         REMOTE_HOST: ${{ secrets.TX_HOST }}
         REMOTE_USER: ${{ secrets.TX_USER }}
         TARGET: ${{ secrets.TX_TARGET }}
        
      
